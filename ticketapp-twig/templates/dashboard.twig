{% extends 'layout.twig' %}
{% block content %}
  <h1 class="text-2xl font-bold mb-4">Dashboard</h1>
  <div id="dashboard-root">Loading...</div>

  <script type="module">
    import { getSession, listTickets } from '/js/app.js'
    (async function(){
      const s = getSession(); if (!s) return window.location.href = '/auth/login'
      try{
        const tickets = await listTickets()
        const total = tickets.length
        const open = tickets.filter(t=>t.status==='open').length
        const resolved = tickets.filter(t=>t.status==='closed').length
        document.getElementById('dashboard-root').innerHTML = `
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="p-4 rounded-lg shadow bg-white"><div class="text-sm text-gray-500">Total Tickets</div><div class="text-2xl font-bold">${total}</div></div>
            <div class="p-4 rounded-lg shadow bg-white"><div class="text-sm text-gray-500">Open</div><div class="text-2xl font-bold">${open}</div></div>
            <div class="p-4 rounded-lg shadow bg-white"><div class="text-sm text-gray-500">Resolved</div><div class="text-2xl font-bold">${resolved}</div></div>
          </div>
          <div class="mt-8"><a href="/tickets" class="px-4 py-2 rounded bg-blue-600 text-white">Manage Tickets</a></div>
        `
      }catch(e){ document.getElementById('dashboard-root').innerHTML = '<div class="text-red-600">Failed to load tickets. Please retry.</div>' }
    })()
  </script>
{% endblock %}
