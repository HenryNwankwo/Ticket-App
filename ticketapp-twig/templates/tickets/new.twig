{% extends 'layout.twig' %}
{% block content %}
  <h1 class="text-2xl font-bold mb-4">New Ticket</h1>
  <div>
    <form id="create-form" class="bg-white p-4 rounded-lg shadow">
      <label class="block mb-2">Title
        <input id="new-title" class="mt-1 block w-full rounded border px-3 py-2" />
      </label>
      <div id="new-title-error" class="text-red-600 text-sm" style="display:none"></div>
      <label class="block mt-4 mb-2">Description
        <textarea id="new-desc" class="mt-1 block w-full rounded border px-3 py-2"></textarea>
      </label>
      <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
        <label> Status
          <select id="new-status" class="mt-1 block w-full rounded border px-3 py-2"><option value="open">open</option><option value="in_progress">in_progress</option><option value="closed">closed</option></select>
        </label>
        <label> Priority
          <select id="new-priority" class="mt-1 block w-full rounded border px-3 py-2"><option value="low">low</option><option value="medium">medium</option><option value="high">high</option></select>
        </label>
      </div>
      <div class="mt-6"><button id="create-btn" type="button" class="px-4 py-2 rounded bg-blue-600 text-white">Save</button></div>
    </form>
  </div>

  <script type="module">
    import { getSession, createTicket } from '/js/app.js'
    (function(){ if (!getSession()) return window.location.href='/auth/login'; document.getElementById('create-btn').addEventListener('click', async ()=>{ const title = document.getElementById('new-title').value.trim(); const desc = document.getElementById('new-desc').value.trim(); const status = document.getElementById('new-status').value; const priority = document.getElementById('new-priority').value; const titleErr = document.getElementById('new-title-error'); titleErr.style.display='none'; if (!title){ titleErr.textContent='Title is required.'; titleErr.style.display='block'; return } try{ await createTicket({ title, description: desc, status, priority }); alert('Ticket created'); window.location.href = '/tickets' }catch(e){ alert('Failed to create ticket') } }) })()
  </script>
{% endblock %}
