{% extends 'layout.twig' %}
{% block content %}
  <h1 class="text-2xl font-bold mb-4">Ticket</h1>
  <div id="edit-root">Loading...</div>
  <script type="module">
    import { getSession, getTicket, updateTicket } from '/js/app.js'
    (async function(){ if (!getSession()) return window.location.href='/auth/login'; const id = '{{ id }}'; try{ const t = await getTicket(id); if (!t){ alert('Ticket not found'); window.location.href='/tickets'; return } document.getElementById('edit-root').innerHTML = ` <form id="edit-form" class="bg-white p-4 rounded-lg shadow"> <label class="block mb-2">Title <input id="edit-title" value="${t.title}" class="mt-1 block w-full rounded border px-3 py-2" /></label> <div id="edit-title-error" class="text-red-600 text-sm" style="display:none"></div> <label class="block mt-4 mb-2">Description <textarea id="edit-desc" class="mt-1 block w-full rounded border px-3 py-2">${t.description}</textarea></label> <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4"> <label> Status <select id="edit-status" class="mt-1 block w-full rounded border px-3 py-2"><option value="open" ${t.status==='open'?'selected':''}>open</option><option value="in_progress" ${t.status==='in_progress'?'selected':''}>in_progress</option><option value="closed" ${t.status==='closed'?'selected':''}>closed</option></select></label> <label> Priority <select id="edit-priority" class="mt-1 block w-full rounded border px-3 py-2"><option value="low" ${t.priority==='low'?'selected':''}>low</option><option value="medium" ${t.priority==='medium'?'selected':''}>medium</option><option value="high" ${t.priority==='high'?'selected':''}>high</option></select></label> </div> <div class="mt-6"><button id="save-btn" type="button" class="px-4 py-2 rounded bg-blue-600 text-white">Save</button></div> </form>`; document.getElementById('save-btn').addEventListener('click', async ()=>{ const title = document.getElementById('edit-title').value.trim(); const desc = document.getElementById('edit-desc').value.trim(); const status = document.getElementById('edit-status').value; const priority = document.getElementById('edit-priority').value; const titleErr = document.getElementById('edit-title-error'); titleErr.style.display='none'; if (!title){ titleErr.textContent='Title is required.'; titleErr.style.display='block'; return } try{ await updateTicket(id, { title, description: desc, status, priority }); alert('Updated'); window.location.href = '/tickets' }catch(e){ alert('Failed to update ticket') } }) }catch(e){ alert('Failed to load ticket') } })()
  </script>
{% endblock %}
